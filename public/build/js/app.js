let step=1;const initialStep=1,lastStep=3,apointment={id:"",name:"",date:"",hour:"",services:[]};function startApp(){showSection(),paginationButtons(),tabs(),previousSection(),nextSection(),queryAPI(),clientId(),clientName(),apointmentDate(),apointmentHour(),showSummary()}function showSection(){const e=document.querySelector(".show");e&&e.classList.remove("show");const t="#step-"+step;document.querySelector(t).classList.add("show");const n=document.querySelector(".current");n&&n.classList.remove("current");const o=`[data-step="${step}"]`;document.querySelector(o).classList.add("current")}function tabs(){document.querySelectorAll(".tabs button").forEach(e=>{e.addEventListener("click",e=>{step=parseInt(e.target.dataset.step),showSection(),paginationButtons()})})}function paginationButtons(){const e=document.querySelector("#next"),t=document.querySelector("#previous");switch(step){case 1:t.classList.add("hide"),e.classList.remove("hide");break;case 3:e.classList.add("hide"),t.classList.remove("hide"),showSummary();break;default:e.classList.remove("hide"),t.classList.remove("hide")}e.addEventListener("click",()=>{}),t.addEventListener("click",()=>{})}function previousSection(){document.querySelector("#previous").addEventListener("click",()=>{step<=1||(step--,paginationButtons(),showSection())})}function nextSection(){document.querySelector("#next").addEventListener("click",()=>{step>=3||(step++,paginationButtons(),showSection())})}async function queryAPI(){try{const e=location.origin+"/api/services",t=await fetch(e);showServices(await t.json())}catch(e){console.log(e)}}function showServices(e){e.forEach(e=>{const{id:t,name:n,price:o}=e,c=document.createElement("P");c.classList.add("service-name"),c.textContent=n;const a=document.createElement("P");a.classList.add("service-price"),a.textContent=o+"â‚¬";const s=document.createElement("DIV");s.classList.add("service"),s.dataset.serviceId=t,s.onclick=function(){selectService(e)},s.appendChild(c),s.appendChild(a),document.querySelector("#services").appendChild(s)})}function selectService(e){const{id:t}=e,{services:n}=apointment,o=document.querySelector(`[data-service-id="${t}"]`);n.some(t=>t.id===e.id)?(apointment.services=n.filter(e=>e.id!==t),o.classList.remove("selected")):(apointment.services=[...n,e],o.classList.add("selected"))}function clientId(){apointment.id=document.querySelector("#id").value}function clientName(){apointment.name=document.querySelector("#name").value}function apointmentDate(){document.querySelector("#date").addEventListener("input",e=>{const t=new Date(e.target.value).getUTCDay();[0].includes(t)?(e.target.value="",showAlert("You can't select Sundays","error","form")):apointment.date=e.target.value})}function apointmentHour(){document.querySelector("#hour").addEventListener("input",e=>{const t=e.target.value.split(":")[0];t<10||t>20?showAlert("The hour must be between 10:00 and 20:00","error","form"):apointment.hour=e.target.value})}function showAlert(e,t,n,o=!0){const c=document.querySelector(".error");c&&c.remove();const a=document.createElement("DIV"),s=document.querySelector("."+n);a.textContent=e,a.classList.add(t),s.appendChild(a),o&&setTimeout(()=>{a.remove()},3e3)}function showSummary(){const e=document.querySelector(".summary-content");for(;e.firstChild;)e.removeChild(e.firstChild);if(Object.values(apointment).includes("")||0===apointment.services.length)return void showAlert("Some values are missing or no services have been selected, please review your apointment","error","summary-content",!1);const{name:t,date:n,hour:o,services:c}=apointment,a=document.createElement("H3");a.textContent="Services summary",e.appendChild(a),c.forEach(t=>{const{price:n,name:o}=t,c=document.createElement("DIV");c.classList.add("service-container");const a=document.createElement("P");a.textContent=o;const s=document.createElement("P");s.innerHTML="<span>Price: </span>$"+n,c.append(a,s),e.appendChild(c)});const s=new Date(n),i=s.getMonth(),r=s.getDate()+2,d=s.getFullYear(),u=new Date(Date.UTC(d,i,r)).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),l=document.createElement("H3");l.textContent="Apointment summary",e.appendChild(l);const m=document.createElement("P");m.innerHTML="<span>Name: </span>"+t;const p=document.createElement("P");p.innerHTML="<span>Date: </span>"+u;const h=document.createElement("P");h.innerHTML="<span>Hour: </span>"+o;const v=document.createElement("BUTTON");v.classList.add("button"),v.textContent="Book apointment",v.onclick=bookApointment,e.append(m,p,h,v)}async function bookApointment(){const{id:e,name:t,date:n,hour:o,services:c}=apointment,a=new FormData,s=c.map(e=>e.id);a.append("userId",e),a.append("name",t),a.append("date",n),a.append("hour",o),a.append("services",s);try{url=location.origin+"/api/apointments";const e=await fetch(url,{method:"POST",body:a});(await e.json()).result&&Swal.fire({icon:"success",title:"Apointment created",text:"Your apointment has been registered",button:"Ok"}).then(()=>{window.location.reload()})}catch(e){Swal.fire({icon:"error",title:"Error",text:"An error ocurred while saving the apointment",button:"Ok"})}}document.addEventListener("DOMContentLoaded",()=>{startApp()});